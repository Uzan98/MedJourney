"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_ssr_src_lib_supabase-rest_ts";
exports.ids = ["_ssr_src_lib_supabase-rest_ts"];
exports.modules = {

/***/ "(ssr)/./src/lib/supabase-rest.ts":
/*!**********************************!*\
  !*** ./src/lib/supabase-rest.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DisciplinesRestService: () => (/* binding */ DisciplinesRestService)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(ssr)/./src/lib/supabase.ts\");\n// supabase-rest.ts\n// Serviço para acessar diretamente a API REST do Supabase\n\n/**\n * URL base para a API REST do Supabase\n * Formato: https://<project-ref>.supabase.co/rest/v1/\n */ const getSupabaseRestUrl = ()=>{\n    // Extrair a URL base do cliente Supabase\n    const supabaseUrl = \"https://ipfjehdwmenpaeuefntd.supabase.co\";\n    if (!supabaseUrl) {\n        throw new Error(\"NEXT_PUBLIC_SUPABASE_URL n\\xe3o est\\xe1 definido\");\n    }\n    return `${supabaseUrl}/rest/v1/`;\n};\n/**\n * Obtém o token de autenticação atual\n */ const getAuthHeaders = async ()=>{\n    const { data } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.getSession();\n    const token = data.session?.access_token;\n    const headers = {\n        \"apikey\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZmplaGR3bWVucGFldWVmbnRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY0ODc3NDYsImV4cCI6MjA2MjA2Mzc0Nn0.FWreWB4-_weiNoQlzoPissyaGELR23mWjcyePX_V0dI\" || 0,\n        \"Content-Type\": \"application/json\"\n    };\n    if (token) {\n        headers[\"Authorization\"] = `Bearer ${token}`;\n    }\n    return headers;\n};\n/**\n * Garante que um usuário exista na tabela users\n * @param userId ID do usuário autenticado\n * @param email Email do usuário\n * @returns O registro do usuário\n */ const ensureUserExists = async (userId, email)=>{\n    try {\n        // Verificar se o usuário já existe na tabela users usando o cliente Supabase\n        const { data: userData, error: checkError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"users\").select(\"*\").eq(\"user_id\", userId).limit(1);\n        if (checkError) {\n            console.error(\"Erro ao verificar usu\\xe1rio:\", checkError);\n            throw new Error(\"Erro ao verificar usu\\xe1rio\");\n        }\n        // Se o usuário já existe, retornar\n        if (userData && userData.length > 0) {\n            console.log(\"Usu\\xe1rio j\\xe1 existe na tabela users:\", userData[0]);\n            return userData[0];\n        }\n        // Se não existe, criar o usuário usando o cliente Supabase (respeitando RLS)\n        console.log(\"Criando registro de usu\\xe1rio na tabela users para:\", userId);\n        const userCreateData = {\n            user_id: userId,\n            email: email || `${userId}@example.com`,\n            name: email ? email.split(\"@\")[0] : \"Usu\\xe1rio\",\n            is_active: true\n        };\n        // Inserir usando o cliente Supabase\n        const { data: newUser, error: createError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"users\").insert([\n            userCreateData\n        ]).select().single();\n        if (createError) {\n            console.error(\"Erro ao criar usu\\xe1rio na tabela users:\", createError);\n            // Tente habilitar temporariamente o modo de serviço para contornar RLS\n            // Nota: Isso só funciona se o usuário tiver permissões adequadas\n            console.log(\"Tentando criar usu\\xe1rio em modo de servi\\xe7o para contornar RLS...\");\n            // Logar informações de diagnóstico\n            console.log(\"Informa\\xe7\\xf5es do usu\\xe1rio atual:\");\n            const { data } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.getUser();\n            console.log(\"- User ID:\", data.user?.id);\n            console.log(\"- Email:\", data.user?.email);\n            console.log(\"- Role:\", data.user?.role);\n            // Retornar um objeto temporário para continuar o fluxo\n            return {\n                id: null,\n                user_id: userId,\n                email: email || `${userId}@example.com`,\n                name: email ? email.split(\"@\")[0] : \"Usu\\xe1rio\",\n                is_active: true,\n                is_temporary: true\n            };\n        }\n        console.log(\"Usu\\xe1rio criado com sucesso na tabela users:\", newUser);\n        return newUser;\n    } catch (error) {\n        console.error(\"Erro ao sincronizar usu\\xe1rio:\", error);\n        // Retornar um objeto temporário para continuar o fluxo\n        return {\n            id: null,\n            user_id: userId,\n            email: email || `${userId}@example.com`,\n            name: email ? email.split(\"@\")[0] : \"Usu\\xe1rio\",\n            is_active: true,\n            is_temporary: true\n        };\n    }\n};\n/**\n * Serviço para manipulação de disciplinas usando a API REST do Supabase\n */ const DisciplinesRestService = {\n    /**\n   * Obtém todas as disciplinas\n   * @param onlyUser Se verdadeiro, retorna apenas as disciplinas do usuário atual\n   */ async getDisciplines (onlyUser = false) {\n        try {\n            const headers = await getAuthHeaders();\n            const url = `${getSupabaseRestUrl()}disciplines`;\n            // Adicionar parâmetros de consulta para filtrar apenas disciplinas do usuário\n            const queryParams = onlyUser ? `?user_id=eq.${(await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.getUser()).data.user?.id}` : \"\";\n            const response = await fetch(`${url}${queryParams}`, {\n                method: \"GET\",\n                headers\n            });\n            if (!response.ok) {\n                const error = await response.json();\n                console.error(\"Erro ao buscar disciplinas:\", error);\n                return [];\n            }\n            const data = await response.json();\n            return data;\n        } catch (error) {\n            console.error(\"Erro ao obter disciplinas:\", error);\n            return [];\n        }\n    },\n    /**\n   * Cria uma nova disciplina\n   * @param discipline Objeto da disciplina\n   */ async createDiscipline (discipline) {\n        try {\n            const { data: { user } } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.getUser();\n            if (!user) {\n                throw new Error(\"Usu\\xe1rio n\\xe3o autenticado\");\n            }\n            console.log(\"Criando disciplina para usu\\xe1rio:\", user.id, user.email);\n            // Garantir que o usuário exista na tabela users antes de criar a disciplina\n            const userInfo = await ensureUserExists(user.id, user.email);\n            console.log(\"Informa\\xe7\\xf5es do usu\\xe1rio:\", userInfo);\n            const headers = await getAuthHeaders();\n            const url = `${getSupabaseRestUrl()}disciplines`;\n            const disciplineData = {\n                name: discipline.name,\n                description: discipline.description || null,\n                theme: discipline.theme || null,\n                user_id: user.id // Sempre usar o ID do Auth\n            };\n            console.log(\"Dados da disciplina a serem enviados:\", disciplineData);\n            // Tentar criar a disciplina diretamente pelo cliente Supabase\n            const { data: newDiscipline, error: disciplineError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"disciplines\").insert([\n                disciplineData\n            ]).select().single();\n            if (disciplineError) {\n                console.error(\"Erro ao criar disciplina via cliente Supabase:\", disciplineError);\n                console.log(\"Tentando via API REST...\");\n                const response = await fetch(url, {\n                    method: \"POST\",\n                    headers,\n                    body: JSON.stringify(disciplineData)\n                });\n                if (!response.ok) {\n                    const error = await response.json();\n                    console.error(\"Erro ao criar disciplina via API REST:\", error);\n                    // Último recurso: se disponível, tentar o serviço de adaptador\n                    try {\n                        console.log(\"Tentando criar disciplina usando adaptador de servi\\xe7o...\");\n                        const apiResponse = await fetch(\"/api/disciplines\", {\n                            method: \"POST\",\n                            headers: {\n                                \"Content-Type\": \"application/json\"\n                            },\n                            body: JSON.stringify(discipline)\n                        });\n                        if (!apiResponse.ok) {\n                            throw new Error(\"Falha no endpoint de API\");\n                        }\n                        const apiData = await apiResponse.json();\n                        return apiData.discipline;\n                    } catch (adaptError) {\n                        console.error(\"Falha em todas as tentativas de criar disciplina:\", adaptError);\n                        return null;\n                    }\n                }\n                const data = await response.json();\n                return data[0];\n            }\n            console.log(\"Disciplina criada com sucesso:\", newDiscipline);\n            return newDiscipline;\n        } catch (error) {\n            console.error(\"Erro ao criar disciplina:\", error);\n            return null;\n        }\n    },\n    /**\n   * Obtém os assuntos de uma disciplina\n   * @param disciplineId ID da disciplina\n   */ async getSubjects (disciplineId) {\n        try {\n            const headers = await getAuthHeaders();\n            const url = `${getSupabaseRestUrl()}subjects?discipline_id=eq.${disciplineId}`;\n            const response = await fetch(url, {\n                method: \"GET\",\n                headers\n            });\n            if (!response.ok) {\n                const error = await response.json();\n                console.error(\"Erro ao buscar assuntos:\", error);\n                return [];\n            }\n            const data = await response.json();\n            return data;\n        } catch (error) {\n            console.error(\"Erro ao buscar assuntos da disciplina:\", error);\n            return [];\n        }\n    },\n    /**\n   * Cria um novo assunto para uma disciplina\n   * @param disciplineId ID da disciplina\n   * @param title Título do assunto\n   * @param content Conteúdo do assunto (opcional)\n   * @param difficulty Dificuldade do assunto (opcional)\n   * @param importance Importância do assunto (opcional)\n   * @param estimatedHours Horas estimadas de estudo (opcional)\n   */ async createSubject (disciplineId, title, content, difficulty = \"m\\xe9dia\", importance = \"m\\xe9dia\", estimatedHours = 2) {\n        try {\n            const { data: { user } } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.getUser();\n            if (!user) {\n                throw new Error(\"Usu\\xe1rio n\\xe3o autenticado\");\n            }\n            console.log(\"Criando assunto para usu\\xe1rio:\", user.id, user.email);\n            // Garantir que o usuário exista na tabela users antes de criar o assunto\n            const userInfo = await ensureUserExists(user.id, user.email);\n            console.log(\"Informa\\xe7\\xf5es do usu\\xe1rio:\", userInfo);\n            const headers = await getAuthHeaders();\n            const url = `${getSupabaseRestUrl()}subjects`;\n            const subjectData = {\n                discipline_id: disciplineId,\n                user_id: user.id,\n                title,\n                content: content || null,\n                status: \"pending\",\n                due_date: null,\n                difficulty,\n                importance,\n                estimated_hours: estimatedHours,\n                name: title // Restaurar o campo de compatibilidade\n            };\n            console.log(\"Dados do assunto a serem enviados:\", subjectData);\n            // Tentar criar o assunto diretamente pelo cliente Supabase\n            const { data: newSubject, error: subjectError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"subjects\").insert([\n                subjectData\n            ]).select().single();\n            if (subjectError) {\n                console.error(\"Erro ao criar assunto via cliente Supabase:\", subjectError);\n                console.log(\"Tentando via API REST...\");\n                const response = await fetch(url, {\n                    method: \"POST\",\n                    headers,\n                    body: JSON.stringify(subjectData)\n                });\n                if (!response.ok) {\n                    const error = await response.json();\n                    console.error(\"Erro ao criar assunto via API REST:\", error);\n                    return null;\n                }\n                const data = await response.json();\n                return data[0];\n            }\n            console.log(\"Assunto criado com sucesso:\", newSubject);\n            return newSubject;\n        } catch (error) {\n            console.error(\"Erro ao criar assunto:\", error);\n            return null;\n        }\n    },\n    /**\n   * Remove uma disciplina\n   * @param disciplineId ID da disciplina a ser removida\n   */ async deleteDiscipline (disciplineId) {\n        try {\n            const { data: { user } } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.getUser();\n            if (!user) {\n                throw new Error(\"Usu\\xe1rio n\\xe3o autenticado\");\n            }\n            console.log(\"Removendo disciplina:\", disciplineId);\n            const headers = await getAuthHeaders();\n            const url = `${getSupabaseRestUrl()}disciplines?id=eq.${disciplineId}`;\n            // Verificar se a disciplina pertence ao usuário atual\n            const { data: discipline, error: fetchError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"disciplines\").select(\"*\").eq(\"id\", disciplineId).single();\n            if (fetchError) {\n                console.error(\"Erro ao verificar disciplina:\", fetchError);\n                return false;\n            }\n            if (!discipline) {\n                console.error(\"Disciplina n\\xe3o encontrada\");\n                return false;\n            }\n            if (discipline.user_id !== user.id) {\n                console.error(\"Sem permiss\\xe3o para excluir essa disciplina\");\n                return false;\n            }\n            // Tentar excluir a disciplina diretamente pelo cliente Supabase\n            const { error: deleteError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"disciplines\").delete().eq(\"id\", disciplineId);\n            if (deleteError) {\n                console.error(\"Erro ao excluir disciplina via cliente Supabase:\", deleteError);\n                console.log(\"Tentando via API REST...\");\n                const response = await fetch(url, {\n                    method: \"DELETE\",\n                    headers\n                });\n                if (!response.ok) {\n                    const error = await response.json();\n                    console.error(\"Erro ao excluir disciplina via API REST:\", error);\n                    return false;\n                }\n                return response.status === 204 || response.status === 200;\n            }\n            console.log(\"Disciplina exclu\\xedda com sucesso\");\n            return true;\n        } catch (error) {\n            console.error(\"Erro ao excluir disciplina:\", error);\n            return false;\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NkIsTUFBTSxLQUFLLE9BQU83QixTQUFTNkIsTUFBTSxLQUFLO1lBQ3hEO1lBRUFuRCxRQUFRRSxHQUFHLENBQUM7WUFDWixPQUFPO1FBQ1QsRUFBRSxPQUFPUixPQUFPO1lBQ2RNLFFBQVFOLEtBQUssQ0FBQywrQkFBK0JBO1lBQzdDLE9BQU87UUFDVDtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL21lZGpvdXJuZXktYXBwLy4vc3JjL2xpYi9zdXBhYmFzZS1yZXN0LnRzPzg3ZWYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3VwYWJhc2UtcmVzdC50c1xuLy8gU2VydmnDp28gcGFyYSBhY2Vzc2FyIGRpcmV0YW1lbnRlIGEgQVBJIFJFU1QgZG8gU3VwYWJhc2VcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi9zdXBhYmFzZSc7XG5pbXBvcnQgdHlwZSB7IERpc2NpcGxpbmUsIFN1YmplY3QgfSBmcm9tICcuL3N1cGFiYXNlJztcblxuLyoqXG4gKiBVUkwgYmFzZSBwYXJhIGEgQVBJIFJFU1QgZG8gU3VwYWJhc2VcbiAqIEZvcm1hdG86IGh0dHBzOi8vPHByb2plY3QtcmVmPi5zdXBhYmFzZS5jby9yZXN0L3YxL1xuICovXG5jb25zdCBnZXRTdXBhYmFzZVJlc3RVcmwgPSAoKSA9PiB7XG4gIC8vIEV4dHJhaXIgYSBVUkwgYmFzZSBkbyBjbGllbnRlIFN1cGFiYXNlXG4gIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuICBpZiAoIXN1cGFiYXNlVXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgbsOjbyBlc3TDoSBkZWZpbmlkbycpO1xuICB9XG4gIHJldHVybiBgJHtzdXBhYmFzZVVybH0vcmVzdC92MS9gO1xufTtcblxuLyoqXG4gKiBPYnTDqW0gbyB0b2tlbiBkZSBhdXRlbnRpY2HDp8OjbyBhdHVhbFxuICovXG5jb25zdCBnZXRBdXRoSGVhZGVycyA9IGFzeW5jICgpID0+IHtcbiAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcbiAgY29uc3QgdG9rZW4gPSBkYXRhLnNlc3Npb24/LmFjY2Vzc190b2tlbjtcbiAgXG4gIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgJ2FwaWtleSc6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8ICcnLFxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gIH07XG4gIFxuICBpZiAodG9rZW4pIHtcbiAgICBoZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7dG9rZW59YDtcbiAgfVxuICBcbiAgcmV0dXJuIGhlYWRlcnM7XG59O1xuXG4vKipcbiAqIEdhcmFudGUgcXVlIHVtIHVzdcOhcmlvIGV4aXN0YSBuYSB0YWJlbGEgdXNlcnNcbiAqIEBwYXJhbSB1c2VySWQgSUQgZG8gdXN1w6FyaW8gYXV0ZW50aWNhZG9cbiAqIEBwYXJhbSBlbWFpbCBFbWFpbCBkbyB1c3XDoXJpb1xuICogQHJldHVybnMgTyByZWdpc3RybyBkbyB1c3XDoXJpb1xuICovXG5jb25zdCBlbnN1cmVVc2VyRXhpc3RzID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nLCBlbWFpbD86IHN0cmluZyk6IFByb21pc2U8YW55PiA9PiB7XG4gIHRyeSB7XG4gICAgLy8gVmVyaWZpY2FyIHNlIG8gdXN1w6FyaW8gasOhIGV4aXN0ZSBuYSB0YWJlbGEgdXNlcnMgdXNhbmRvIG8gY2xpZW50ZSBTdXBhYmFzZVxuICAgIGNvbnN0IHsgZGF0YTogdXNlckRhdGEsIGVycm9yOiBjaGVja0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmxpbWl0KDEpO1xuICAgIFxuICAgIGlmIChjaGVja0Vycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIHZlcmlmaWNhciB1c3XDoXJpbzonLCBjaGVja0Vycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRXJybyBhbyB2ZXJpZmljYXIgdXN1w6FyaW8nKTtcbiAgICB9XG4gICAgXG4gICAgLy8gU2UgbyB1c3XDoXJpbyBqw6EgZXhpc3RlLCByZXRvcm5hclxuICAgIGlmICh1c2VyRGF0YSAmJiB1c2VyRGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zb2xlLmxvZygnVXN1w6FyaW8gasOhIGV4aXN0ZSBuYSB0YWJlbGEgdXNlcnM6JywgdXNlckRhdGFbMF0pO1xuICAgICAgcmV0dXJuIHVzZXJEYXRhWzBdO1xuICAgIH1cbiAgICBcbiAgICAvLyBTZSBuw6NvIGV4aXN0ZSwgY3JpYXIgbyB1c3XDoXJpbyB1c2FuZG8gbyBjbGllbnRlIFN1cGFiYXNlIChyZXNwZWl0YW5kbyBSTFMpXG4gICAgY29uc29sZS5sb2coJ0NyaWFuZG8gcmVnaXN0cm8gZGUgdXN1w6FyaW8gbmEgdGFiZWxhIHVzZXJzIHBhcmE6JywgdXNlcklkKTtcbiAgICBcbiAgICBjb25zdCB1c2VyQ3JlYXRlRGF0YSA9IHtcbiAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgIGVtYWlsOiBlbWFpbCB8fCBgJHt1c2VySWR9QGV4YW1wbGUuY29tYCxcbiAgICAgIG5hbWU6IGVtYWlsID8gZW1haWwuc3BsaXQoJ0AnKVswXSA6ICdVc3XDoXJpbycsXG4gICAgICBpc19hY3RpdmU6IHRydWVcbiAgICB9O1xuICAgIFxuICAgIC8vIEluc2VyaXIgdXNhbmRvIG8gY2xpZW50ZSBTdXBhYmFzZVxuICAgIGNvbnN0IHsgZGF0YTogbmV3VXNlciwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgIC5pbnNlcnQoW3VzZXJDcmVhdGVEYXRhXSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpO1xuICAgIFxuICAgIGlmIChjcmVhdGVFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBjcmlhciB1c3XDoXJpbyBuYSB0YWJlbGEgdXNlcnM6JywgY3JlYXRlRXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBUZW50ZSBoYWJpbGl0YXIgdGVtcG9yYXJpYW1lbnRlIG8gbW9kbyBkZSBzZXJ2acOnbyBwYXJhIGNvbnRvcm5hciBSTFNcbiAgICAgIC8vIE5vdGE6IElzc28gc8OzIGZ1bmNpb25hIHNlIG8gdXN1w6FyaW8gdGl2ZXIgcGVybWlzc8O1ZXMgYWRlcXVhZGFzXG4gICAgICBjb25zb2xlLmxvZygnVGVudGFuZG8gY3JpYXIgdXN1w6FyaW8gZW0gbW9kbyBkZSBzZXJ2acOnbyBwYXJhIGNvbnRvcm5hciBSTFMuLi4nKTtcbiAgICAgIFxuICAgICAgLy8gTG9nYXIgaW5mb3JtYcOnw7VlcyBkZSBkaWFnbsOzc3RpY29cbiAgICAgIGNvbnNvbGUubG9nKCdJbmZvcm1hw6fDtWVzIGRvIHVzdcOhcmlvIGF0dWFsOicpO1xuICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgICAgIGNvbnNvbGUubG9nKCctIFVzZXIgSUQ6JywgZGF0YS51c2VyPy5pZCk7XG4gICAgICBjb25zb2xlLmxvZygnLSBFbWFpbDonLCBkYXRhLnVzZXI/LmVtYWlsKTtcbiAgICAgIGNvbnNvbGUubG9nKCctIFJvbGU6JywgZGF0YS51c2VyPy5yb2xlKTtcbiAgICAgIFxuICAgICAgLy8gUmV0b3JuYXIgdW0gb2JqZXRvIHRlbXBvcsOhcmlvIHBhcmEgY29udGludWFyIG8gZmx1eG9cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBudWxsLFxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgIGVtYWlsOiBlbWFpbCB8fCBgJHt1c2VySWR9QGV4YW1wbGUuY29tYCxcbiAgICAgICAgbmFtZTogZW1haWwgPyBlbWFpbC5zcGxpdCgnQCcpWzBdIDogJ1VzdcOhcmlvJyxcbiAgICAgICAgaXNfYWN0aXZlOiB0cnVlLFxuICAgICAgICBpc190ZW1wb3Jhcnk6IHRydWVcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKCdVc3XDoXJpbyBjcmlhZG8gY29tIHN1Y2Vzc28gbmEgdGFiZWxhIHVzZXJzOicsIG5ld1VzZXIpO1xuICAgIHJldHVybiBuZXdVc2VyO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gc2luY3Jvbml6YXIgdXN1w6FyaW86JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIFJldG9ybmFyIHVtIG9iamV0byB0ZW1wb3LDoXJpbyBwYXJhIGNvbnRpbnVhciBvIGZsdXhvXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBudWxsLFxuICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgZW1haWw6IGVtYWlsIHx8IGAke3VzZXJJZH1AZXhhbXBsZS5jb21gLFxuICAgICAgbmFtZTogZW1haWwgPyBlbWFpbC5zcGxpdCgnQCcpWzBdIDogJ1VzdcOhcmlvJyxcbiAgICAgIGlzX2FjdGl2ZTogdHJ1ZSxcbiAgICAgIGlzX3RlbXBvcmFyeTogdHJ1ZVxuICAgIH07XG4gIH1cbn07XG5cbi8qKlxuICogU2VydmnDp28gcGFyYSBtYW5pcHVsYcOnw6NvIGRlIGRpc2NpcGxpbmFzIHVzYW5kbyBhIEFQSSBSRVNUIGRvIFN1cGFiYXNlXG4gKi9cbmV4cG9ydCBjb25zdCBEaXNjaXBsaW5lc1Jlc3RTZXJ2aWNlID0ge1xuICAvKipcbiAgICogT2J0w6ltIHRvZGFzIGFzIGRpc2NpcGxpbmFzXG4gICAqIEBwYXJhbSBvbmx5VXNlciBTZSB2ZXJkYWRlaXJvLCByZXRvcm5hIGFwZW5hcyBhcyBkaXNjaXBsaW5hcyBkbyB1c3XDoXJpbyBhdHVhbFxuICAgKi9cbiAgYXN5bmMgZ2V0RGlzY2lwbGluZXMob25seVVzZXIgPSBmYWxzZSk6IFByb21pc2U8RGlzY2lwbGluZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSBhd2FpdCBnZXRBdXRoSGVhZGVycygpO1xuICAgICAgY29uc3QgdXJsID0gYCR7Z2V0U3VwYWJhc2VSZXN0VXJsKCl9ZGlzY2lwbGluZXNgO1xuICAgICAgXG4gICAgICAvLyBBZGljaW9uYXIgcGFyw6JtZXRyb3MgZGUgY29uc3VsdGEgcGFyYSBmaWx0cmFyIGFwZW5hcyBkaXNjaXBsaW5hcyBkbyB1c3XDoXJpb1xuICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSBvbmx5VXNlciA/IFxuICAgICAgICBgP3VzZXJfaWQ9ZXEuJHsoYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCkpLmRhdGEudXNlcj8uaWR9YCA6ICcnO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3VybH0ke3F1ZXJ5UGFyYW1zfWAsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyc1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gYnVzY2FyIGRpc2NpcGxpbmFzOicsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIGRhdGEgYXMgRGlzY2lwbGluZVtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIG9idGVyIGRpc2NpcGxpbmFzOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH0sXG4gIFxuICAvKipcbiAgICogQ3JpYSB1bWEgbm92YSBkaXNjaXBsaW5hXG4gICAqIEBwYXJhbSBkaXNjaXBsaW5lIE9iamV0byBkYSBkaXNjaXBsaW5hXG4gICAqL1xuICBhc3luYyBjcmVhdGVEaXNjaXBsaW5lKFxuICAgIGRpc2NpcGxpbmU6IHtcbiAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgICAgdGhlbWU/OiBzdHJpbmc7XG4gICAgfVxuICApOiBQcm9taXNlPERpc2NpcGxpbmUgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuICAgICAgXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc3XDoXJpbyBuw6NvIGF1dGVudGljYWRvJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdDcmlhbmRvIGRpc2NpcGxpbmEgcGFyYSB1c3XDoXJpbzonLCB1c2VyLmlkLCB1c2VyLmVtYWlsKTtcbiAgICAgIFxuICAgICAgLy8gR2FyYW50aXIgcXVlIG8gdXN1w6FyaW8gZXhpc3RhIG5hIHRhYmVsYSB1c2VycyBhbnRlcyBkZSBjcmlhciBhIGRpc2NpcGxpbmFcbiAgICAgIGNvbnN0IHVzZXJJbmZvID0gYXdhaXQgZW5zdXJlVXNlckV4aXN0cyh1c2VyLmlkLCB1c2VyLmVtYWlsKTtcbiAgICAgIGNvbnNvbGUubG9nKCdJbmZvcm1hw6fDtWVzIGRvIHVzdcOhcmlvOicsIHVzZXJJbmZvKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGVhZGVycyA9IGF3YWl0IGdldEF1dGhIZWFkZXJzKCk7XG4gICAgICBjb25zdCB1cmwgPSBgJHtnZXRTdXBhYmFzZVJlc3RVcmwoKX1kaXNjaXBsaW5lc2A7XG4gICAgICBcbiAgICAgIGNvbnN0IGRpc2NpcGxpbmVEYXRhID0ge1xuICAgICAgICBuYW1lOiBkaXNjaXBsaW5lLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkaXNjaXBsaW5lLmRlc2NyaXB0aW9uIHx8IG51bGwsXG4gICAgICAgIHRoZW1lOiBkaXNjaXBsaW5lLnRoZW1lIHx8IG51bGwsXG4gICAgICAgIHVzZXJfaWQ6IHVzZXIuaWQgLy8gU2VtcHJlIHVzYXIgbyBJRCBkbyBBdXRoXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnRGFkb3MgZGEgZGlzY2lwbGluYSBhIHNlcmVtIGVudmlhZG9zOicsIGRpc2NpcGxpbmVEYXRhKTtcbiAgICAgIFxuICAgICAgLy8gVGVudGFyIGNyaWFyIGEgZGlzY2lwbGluYSBkaXJldGFtZW50ZSBwZWxvIGNsaWVudGUgU3VwYWJhc2VcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3RGlzY2lwbGluZSwgZXJyb3I6IGRpc2NpcGxpbmVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2Rpc2NpcGxpbmVzJylcbiAgICAgICAgLmluc2VydChbZGlzY2lwbGluZURhdGFdKVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgXG4gICAgICBpZiAoZGlzY2lwbGluZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gY3JpYXIgZGlzY2lwbGluYSB2aWEgY2xpZW50ZSBTdXBhYmFzZTonLCBkaXNjaXBsaW5lRXJyb3IpO1xuICAgICAgICBjb25zb2xlLmxvZygnVGVudGFuZG8gdmlhIEFQSSBSRVNULi4uJyk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGlzY2lwbGluZURhdGEpXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gY3JpYXIgZGlzY2lwbGluYSB2aWEgQVBJIFJFU1Q6JywgZXJyb3IpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIMOabHRpbW8gcmVjdXJzbzogc2UgZGlzcG9uw612ZWwsIHRlbnRhciBvIHNlcnZpw6dvIGRlIGFkYXB0YWRvclxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVGVudGFuZG8gY3JpYXIgZGlzY2lwbGluYSB1c2FuZG8gYWRhcHRhZG9yIGRlIHNlcnZpw6dvLi4uJyk7XG4gICAgICAgICAgICBjb25zdCBhcGlSZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2Rpc2NpcGxpbmVzJywge1xuICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGlzY2lwbGluZSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIWFwaVJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFsaGEgbm8gZW5kcG9pbnQgZGUgQVBJJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFwaURhdGEgPSBhd2FpdCBhcGlSZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICByZXR1cm4gYXBpRGF0YS5kaXNjaXBsaW5lO1xuICAgICAgICAgIH0gY2F0Y2ggKGFkYXB0RXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhbGhhIGVtIHRvZGFzIGFzIHRlbnRhdGl2YXMgZGUgY3JpYXIgZGlzY2lwbGluYTonLCBhZGFwdEVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgcmV0dXJuIGRhdGFbMF0gYXMgRGlzY2lwbGluZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ0Rpc2NpcGxpbmEgY3JpYWRhIGNvbSBzdWNlc3NvOicsIG5ld0Rpc2NpcGxpbmUpO1xuICAgICAgcmV0dXJuIG5ld0Rpc2NpcGxpbmU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gY3JpYXIgZGlzY2lwbGluYTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH0sXG4gIFxuICAvKipcbiAgICogT2J0w6ltIG9zIGFzc3VudG9zIGRlIHVtYSBkaXNjaXBsaW5hXG4gICAqIEBwYXJhbSBkaXNjaXBsaW5lSWQgSUQgZGEgZGlzY2lwbGluYVxuICAgKi9cbiAgYXN5bmMgZ2V0U3ViamVjdHMoZGlzY2lwbGluZUlkOiBudW1iZXIpOiBQcm9taXNlPFN1YmplY3RbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBoZWFkZXJzID0gYXdhaXQgZ2V0QXV0aEhlYWRlcnMoKTtcbiAgICAgIGNvbnN0IHVybCA9IGAke2dldFN1cGFiYXNlUmVzdFVybCgpfXN1YmplY3RzP2Rpc2NpcGxpbmVfaWQ9ZXEuJHtkaXNjaXBsaW5lSWR9YDtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyc1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gYnVzY2FyIGFzc3VudG9zOicsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIGRhdGEgYXMgU3ViamVjdFtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIGJ1c2NhciBhc3N1bnRvcyBkYSBkaXNjaXBsaW5hOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH0sXG4gIFxuICAvKipcbiAgICogQ3JpYSB1bSBub3ZvIGFzc3VudG8gcGFyYSB1bWEgZGlzY2lwbGluYVxuICAgKiBAcGFyYW0gZGlzY2lwbGluZUlkIElEIGRhIGRpc2NpcGxpbmFcbiAgICogQHBhcmFtIHRpdGxlIFTDrXR1bG8gZG8gYXNzdW50b1xuICAgKiBAcGFyYW0gY29udGVudCBDb250ZcO6ZG8gZG8gYXNzdW50byAob3BjaW9uYWwpXG4gICAqIEBwYXJhbSBkaWZmaWN1bHR5IERpZmljdWxkYWRlIGRvIGFzc3VudG8gKG9wY2lvbmFsKVxuICAgKiBAcGFyYW0gaW1wb3J0YW5jZSBJbXBvcnTDom5jaWEgZG8gYXNzdW50byAob3BjaW9uYWwpXG4gICAqIEBwYXJhbSBlc3RpbWF0ZWRIb3VycyBIb3JhcyBlc3RpbWFkYXMgZGUgZXN0dWRvIChvcGNpb25hbClcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVN1YmplY3QoXG4gICAgZGlzY2lwbGluZUlkOiBudW1iZXIsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICBjb250ZW50Pzogc3RyaW5nLFxuICAgIGRpZmZpY3VsdHk6ICdiYWl4YScgfCAnbcOpZGlhJyB8ICdhbHRhJyA9ICdtw6lkaWEnLFxuICAgIGltcG9ydGFuY2U6ICdiYWl4YScgfCAnbcOpZGlhJyB8ICdhbHRhJyA9ICdtw6lkaWEnLFxuICAgIGVzdGltYXRlZEhvdXJzOiBudW1iZXIgPSAyXG4gICk6IFByb21pc2U8U3ViamVjdCB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG4gICAgICBcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzdcOhcmlvIG7Do28gYXV0ZW50aWNhZG8nKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ0NyaWFuZG8gYXNzdW50byBwYXJhIHVzdcOhcmlvOicsIHVzZXIuaWQsIHVzZXIuZW1haWwpO1xuICAgICAgXG4gICAgICAvLyBHYXJhbnRpciBxdWUgbyB1c3XDoXJpbyBleGlzdGEgbmEgdGFiZWxhIHVzZXJzIGFudGVzIGRlIGNyaWFyIG8gYXNzdW50b1xuICAgICAgY29uc3QgdXNlckluZm8gPSBhd2FpdCBlbnN1cmVVc2VyRXhpc3RzKHVzZXIuaWQsIHVzZXIuZW1haWwpO1xuICAgICAgY29uc29sZS5sb2coJ0luZm9ybWHDp8O1ZXMgZG8gdXN1w6FyaW86JywgdXNlckluZm8pO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFkZXJzID0gYXdhaXQgZ2V0QXV0aEhlYWRlcnMoKTtcbiAgICAgIGNvbnN0IHVybCA9IGAke2dldFN1cGFiYXNlUmVzdFVybCgpfXN1YmplY3RzYDtcbiAgICAgIFxuICAgICAgY29uc3Qgc3ViamVjdERhdGEgPSB7XG4gICAgICAgIGRpc2NpcGxpbmVfaWQ6IGRpc2NpcGxpbmVJZCxcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCwgLy8gU2VtcHJlIHVzYXIgbyBJRCBkbyBBdXRoXG4gICAgICAgIHRpdGxlLFxuICAgICAgICBjb250ZW50OiBjb250ZW50IHx8IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICBkdWVfZGF0ZTogbnVsbCxcbiAgICAgICAgZGlmZmljdWx0eSxcbiAgICAgICAgaW1wb3J0YW5jZSxcbiAgICAgICAgZXN0aW1hdGVkX2hvdXJzOiBlc3RpbWF0ZWRIb3VycyxcbiAgICAgICAgbmFtZTogdGl0bGUgLy8gUmVzdGF1cmFyIG8gY2FtcG8gZGUgY29tcGF0aWJpbGlkYWRlXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnRGFkb3MgZG8gYXNzdW50byBhIHNlcmVtIGVudmlhZG9zOicsIHN1YmplY3REYXRhKTtcbiAgICAgIFxuICAgICAgLy8gVGVudGFyIGNyaWFyIG8gYXNzdW50byBkaXJldGFtZW50ZSBwZWxvIGNsaWVudGUgU3VwYWJhc2VcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3U3ViamVjdCwgZXJyb3I6IHN1YmplY3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3N1YmplY3RzJylcbiAgICAgICAgLmluc2VydChbc3ViamVjdERhdGFdKVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgXG4gICAgICBpZiAoc3ViamVjdEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gY3JpYXIgYXNzdW50byB2aWEgY2xpZW50ZSBTdXBhYmFzZTonLCBzdWJqZWN0RXJyb3IpO1xuICAgICAgICBjb25zb2xlLmxvZygnVGVudGFuZG8gdmlhIEFQSSBSRVNULi4uJyk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc3ViamVjdERhdGEpXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gY3JpYXIgYXNzdW50byB2aWEgQVBJIFJFU1Q6JywgZXJyb3IpO1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICByZXR1cm4gZGF0YVswXSBhcyBTdWJqZWN0O1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnQXNzdW50byBjcmlhZG8gY29tIHN1Y2Vzc286JywgbmV3U3ViamVjdCk7XG4gICAgICByZXR1cm4gbmV3U3ViamVjdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBjcmlhciBhc3N1bnRvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSxcbiAgXG4gIC8qKlxuICAgKiBSZW1vdmUgdW1hIGRpc2NpcGxpbmFcbiAgICogQHBhcmFtIGRpc2NpcGxpbmVJZCBJRCBkYSBkaXNjaXBsaW5hIGEgc2VyIHJlbW92aWRhXG4gICAqL1xuICBhc3luYyBkZWxldGVEaXNjaXBsaW5lKGRpc2NpcGxpbmVJZDogbnVtYmVyKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuICAgICAgXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc3XDoXJpbyBuw6NvIGF1dGVudGljYWRvJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdSZW1vdmVuZG8gZGlzY2lwbGluYTonLCBkaXNjaXBsaW5lSWQpO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFkZXJzID0gYXdhaXQgZ2V0QXV0aEhlYWRlcnMoKTtcbiAgICAgIGNvbnN0IHVybCA9IGAke2dldFN1cGFiYXNlUmVzdFVybCgpfWRpc2NpcGxpbmVzP2lkPWVxLiR7ZGlzY2lwbGluZUlkfWA7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIGRpc2NpcGxpbmEgcGVydGVuY2UgYW8gdXN1w6FyaW8gYXR1YWxcbiAgICAgIGNvbnN0IHsgZGF0YTogZGlzY2lwbGluZSwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkaXNjaXBsaW5lcycpXG4gICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAuZXEoJ2lkJywgZGlzY2lwbGluZUlkKVxuICAgICAgICAuc2luZ2xlKCk7XG4gICAgICBcbiAgICAgIGlmIChmZXRjaEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gdmVyaWZpY2FyIGRpc2NpcGxpbmE6JywgZmV0Y2hFcnJvcik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKCFkaXNjaXBsaW5lKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Rpc2NpcGxpbmEgbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGRpc2NpcGxpbmUudXNlcl9pZCAhPT0gdXNlci5pZCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdTZW0gcGVybWlzc8OjbyBwYXJhIGV4Y2x1aXIgZXNzYSBkaXNjaXBsaW5hJyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVGVudGFyIGV4Y2x1aXIgYSBkaXNjaXBsaW5hIGRpcmV0YW1lbnRlIHBlbG8gY2xpZW50ZSBTdXBhYmFzZVxuICAgICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkaXNjaXBsaW5lcycpXG4gICAgICAgIC5kZWxldGUoKVxuICAgICAgICAuZXEoJ2lkJywgZGlzY2lwbGluZUlkKTtcbiAgICAgIFxuICAgICAgaWYgKGRlbGV0ZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gZXhjbHVpciBkaXNjaXBsaW5hIHZpYSBjbGllbnRlIFN1cGFiYXNlOicsIGRlbGV0ZUVycm9yKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1RlbnRhbmRvIHZpYSBBUEkgUkVTVC4uLicpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBleGNsdWlyIGRpc2NpcGxpbmEgdmlhIEFQSSBSRVNUOicsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMgPT09IDIwNCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDIwMDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ0Rpc2NpcGxpbmEgZXhjbHXDrWRhIGNvbSBzdWNlc3NvJyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBleGNsdWlyIGRpc2NpcGxpbmE6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxufTsgIl0sIm5hbWVzIjpbInN1cGFiYXNlIiwiZ2V0U3VwYWJhc2VSZXN0VXJsIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiRXJyb3IiLCJnZXRBdXRoSGVhZGVycyIsImRhdGEiLCJhdXRoIiwiZ2V0U2Vzc2lvbiIsInRva2VuIiwic2Vzc2lvbiIsImFjY2Vzc190b2tlbiIsImhlYWRlcnMiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImVuc3VyZVVzZXJFeGlzdHMiLCJ1c2VySWQiLCJlbWFpbCIsInVzZXJEYXRhIiwiZXJyb3IiLCJjaGVja0Vycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibGltaXQiLCJjb25zb2xlIiwibGVuZ3RoIiwibG9nIiwidXNlckNyZWF0ZURhdGEiLCJ1c2VyX2lkIiwibmFtZSIsInNwbGl0IiwiaXNfYWN0aXZlIiwibmV3VXNlciIsImNyZWF0ZUVycm9yIiwiaW5zZXJ0Iiwic2luZ2xlIiwiZ2V0VXNlciIsInVzZXIiLCJpZCIsInJvbGUiLCJpc190ZW1wb3JhcnkiLCJEaXNjaXBsaW5lc1Jlc3RTZXJ2aWNlIiwiZ2V0RGlzY2lwbGluZXMiLCJvbmx5VXNlciIsInVybCIsInF1ZXJ5UGFyYW1zIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsIm9rIiwianNvbiIsImNyZWF0ZURpc2NpcGxpbmUiLCJkaXNjaXBsaW5lIiwidXNlckluZm8iLCJkaXNjaXBsaW5lRGF0YSIsImRlc2NyaXB0aW9uIiwidGhlbWUiLCJuZXdEaXNjaXBsaW5lIiwiZGlzY2lwbGluZUVycm9yIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhcGlSZXNwb25zZSIsImFwaURhdGEiLCJhZGFwdEVycm9yIiwiZ2V0U3ViamVjdHMiLCJkaXNjaXBsaW5lSWQiLCJjcmVhdGVTdWJqZWN0IiwidGl0bGUiLCJjb250ZW50IiwiZGlmZmljdWx0eSIsImltcG9ydGFuY2UiLCJlc3RpbWF0ZWRIb3VycyIsInN1YmplY3REYXRhIiwiZGlzY2lwbGluZV9pZCIsInN0YXR1cyIsImR1ZV9kYXRlIiwiZXN0aW1hdGVkX2hvdXJzIiwibmV3U3ViamVjdCIsInN1YmplY3RFcnJvciIsImRlbGV0ZURpc2NpcGxpbmUiLCJmZXRjaEVycm9yIiwiZGVsZXRlRXJyb3IiLCJkZWxldGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./src/lib/supabase-rest.ts\n");

/***/ })

};
;